{% block content %}
  {% set table_id="vrule-table" %}
  {% if main %}
    {% set show_sources=True %}
    {% set show_attribute=True %}
    {% set show_group=True %}
  {% else %}
    {% set table_id=table_id+"-"+parent_id%}
  {% endif %}
  <div id="{{table_id}}-wrapper">
    <table id="{{table_id}}" class="table table-striped table-hover">
      <thead>
        <tr>
          <th>ID</th>
          {% if show_sources %}
            <th>Sources</th>
          {% endif %}
          {% if show_attribute %}
            <th>Attribute</th>
          {% endif %}
          {% if show_group %}
            <th>Group</th>
            <th>Group Portion</th>
          {% endif %}
          <th>Operator</th>
          <th>Reference</th>
          <th>Tags</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for vrule in vrules %}
          <tr>
            <td>{{ vrule.id }}</td>
            {% if show_sources %}
              <td>
                {% if vrule.source is string %}
                  {% set related_type, related_id, prev =
                     'extract', vrule.source, 'vrule_list' %}
                  {% include 'related_record_link.html' %}
                {% else %}
                  {% for source in vrule.source %}
                    {% set related_type, related_id, prev =
                       'extract', source, 'vrule_list' %}
                    {% include 'related_record_link.html' %}
                    <br/>
                  {% endfor %}
                {% endif %}
              </td>
            {% endif %}
            {% if show_attribute %}
              <td>
                {% set related_type, related_id, prev =
                   'attribute', vrule.attribute, 'vrule_list' %}
                {% include 'related_record_link.html' %}
              </td>
            {% endif %}
            {% if show_group %}
              <td>
                {% set related_type, related_id, prev =
                   'group', vrule.group.id, 'vrule_list' %}
                {% include 'related_record_link.html' %}
              </td>
              <td>
                {% if vrule.group.portion %}
                  {{ vrule.group.portion }}
                {% endif %}
              </td>
            {% endif %}
            <td>{{ vrule.operator }}</td>
            <td>{{ vrule.reference }}</td>
            <td>
              {% set tags = vrule.tags %}
              {% include 'show_tags.html' %}
            </td>
            <td>
              <a href="{{ url_for('edit_vrule', record_id=vrule.id) }}"><i class="fas fa-edit"></i></a>
              <form action="{{ url_for('delete_vrule', record_id=vrule.id) }}" method="post" style="display: inline-block;">
               <input type="hidden" name="_method" value="DELETE">
                <button type="submit" class="btn btn-link"><i class="fas fa-trash"></i></button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% if not main %}
    <script type="module">
      import { initNestedTable } from '{{ url_for('static', filename='js/nested_table.js') }}';
      $(document).ready(function() { initNestedTable("{{table_id}}"); });
    </script>
  {% endif %}
{% endblock %}

