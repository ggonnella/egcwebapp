<script type="module">
  import { openNestedTable, openRelatedNested } from
    '{{ url_for('static', filename='js/nested_table.js') }}';
  import { initRelatedTooltips } from
    '{{ url_for('static', filename='js/tooltips.js') }}';

  $(function() {
    {% for nested_kind in info.ref_by_kinds %}
      $('body').on('click', `.show-{{ record_kind }}s-{{ nested_kind }}s`,
            openNestedTable('{{ record_kind }}s', '{{ nested_kind }}s',
            {{ info.nested_colspan }}));
    {% endfor %}
    {% for related_kind in info.ref_kinds %}
      $('body').on('click', `.related-{{ record_kind }}s-{{ related_kind }}s`,
            openRelatedNested('{{ record_kind }}s', '{{ related_kind }}s',
            {{ info.nested_colspan }}));
    {% endfor %}
  });

  {% if main %}
      {% set initTable = 'initMainTable' %}
  {% else %}
      {% set initTable = 'initNestedTable' %}
  {% endif %}
  import { {{ initTable }} } from '{{ url_for('static', filename='js/nested_table.js') }}';
  {% set ttscript = tooltip_js(record_kind) %}
  {% if ttscript %}
    import { initRecordKindSpecificTooltips } from '{{ url_for('static', filename=ttscript) }}';
  {% endif %}
  $(document).ready(function() {
    {% if table_id %}
      var table = {{initTable}}("{{table_id}}", function () {
          {% for related_kind in info.ref_kinds %}
            initRelatedTooltips(".{{ related_kind }}-info", "{{ related_kind }}s");
          {% endfor %}
          {% if ttscript %}
            initRecordKindSpecificTooltips();
          {% endif %}
        }
      );
    {% endif %}
  });
</script>
