{% block content %}
  {% set table_id="extract-table" %}
  {% if main %}
  {% set show_document=True %}
  {% else %}
  {% set table_id=table_id+"-"+parent_id%}
  {% endif %}
  <div id="{{table_id}}-wrapper">
    <table id="{{table_id}}" class="table table-striped table-hover">
      <thead>
        <tr>
            <th>Record Type</th>
            <th>ID</th>
            {% if show_document %}
              <th>Document</th>
            {% endif %}
            <th>Text / Table Reference</th>
            <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for extract in extracts %}
          <tr>
            <td>{{ extract.record_type }}</td>
            <td>{{ extract.id }}</td>
            {% if show_document %}
              <td style:"white-space: nowrap;">
                {% set document_record_id = egc_data.
                     compute_docid_from_pfx_and_item(
                       extract.document_id.resource_prefix,
                       extract.document_id.item) %}
                <span class="document-id"
                      style="display: inline;"
                      data-document-id="{{ document_record_id }}">
                  <a href="{{ url_for('show_document',
                                record_id=document_record_id,
                                previous_page='extract_list') }}"
                     >{{ extract.document_id.resource_prefix }}:{{ extract.document_id.item }}</a></span><span
                   class="document-info" style="display: inline;">&nbsp;&#9432;</span><span
                   style="display: inline;">
                   <a href="{{ url_for('edit_document',
                                  record_id=document_record_id,
                                  previous_page='extract_list') }}">
                     <i class="fa fa-edit" style="color: black;"></i></a></span>
              </td>
            {% endif %}
            <td>{{ extract.text if extract.record_type == "S" else extract.table_ref }}</td>
            <td>
              <a href="{{ url_for('edit_extract', record_id=extract.id) }}"><i class="fas fa-edit"></i></a>
              <form action="{{ url_for('delete_extract', record_id=extract.id) }}" method="post" style="display: inline-block;">
                <input type="hidden" name="_method" value="DELETE">
                <button type="submit" class="btn btn-link"><i class="fas fa-trash"></i></button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% if not main %}
    <script>
      $(document).ready(function() {
          var table = $("#extract-table-{{parent_id}}").DataTable();
          // Create the close button with the FontAwesome icon
          // Attach the click event to the close button
          // Insert the close button as a sibling element of the search input
          var closeButton = $('<button id="close-nested-table" class="btn btn-sm btn-light" style="margin-left: 10px;"><i class="fas fa-times"></i></button>');
          closeButton.on('click', closeNestedTable);
          $("#extract-table-{{parent_id}}-wrapper .dataTables_filter").append(closeButton);
          return table;
      });

      // Function to remove the nested table when the close button is clicked
      function closeNestedTable() {
          var $nestedExtracts = $(this).closest('div.dataTables_wrapper').parent().parent().parent();
          if ($nestedExtracts.length > 0) {
              $nestedExtracts.remove();
          }
      }
    </script>
  {% endif %}
{% endblock %}
