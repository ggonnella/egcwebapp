{% block content %}
  {% set table_id="document-table" %}
  {% if main %}
  {% set show_refby=True %}
  {% else %}
  {% set table_id=table_id+"-"+parent_id%}
  {% endif %}
  <div id="{{table_id}}-wrapper">
    <table id="{{table_id}}" class="table table-striped table-hover">
      <thead>
          <tr>
            <th>PMID</th>
            <th>Link</th>
            <th>Tags</th>
            {% if show_refby %}
              <th>Extracts</th>
            {% endif %}
            <th>Actions</th>
          </tr>
      </thead>
      <tbody>
          {% for document in documents %}
             {% set record_id = egc_data.compute_id(document) %}
              <tr>
                  <td style:"white-space: nowrap;">
                    <span class="document-id" style="display: inline;"
                      ><a href="https://pubmed.ncbi.nlm.nih.gov/{{ document.document_id.item }}"
                        target="_blank" class="no-underline pmid-link"
                      >{{ document.document_id.item }}</a></span><span
                        class="document-info"
                        style="display: inline;">&nbsp;&#9432;</span>
                  </td>

                  <td>
                    <a href="{{ document.link }}" target="_blank"
                        class="no-underline document-link">
                          {{ document.link }}
                      </a>
                  </td>
                  <td>
                    {% set tags = document.tags %}
                    {% include 'tags_lines.html' %}
                  </td>
                  {% if show_refby %}
                    <td>
                      <div class="extracts-count" data-record-id="{{ record_id }}">
                        <a href="#" class="show-extracts"
                          >{{ (egc_data.ref_by_ids('D', record_id,'S') +
                              egc_data.ref_by_ids('D', record_id, 'T')) | length }} extracts</a>
                      </div>
                    </td>
                  {% endif %}
                  <td>
                      <a href="{{ url_for('edit_document', record_id=record_id) }}"
                        ><i class="fas fa-edit"></i></a>
                      <form action="{{ url_for('delete_document', record_id=record_id) }}"
                          method="post" style="display: inline-block;">
                        <input type="hidden" name="_method" value="DELETE">
                        <button type="submit" class="btn btn-link"
                          ><i class="fas fa-trash"></i></button>
                      </form>
                  </td>
              </tr>
          {% endfor %}
      </tbody>
    </table>
  </div>
  {% if show_refby %}
    <script type="module">
     import { openNestedTable } from
        '{{ url_for('static', filename='js/nested_table.js') }}';
      $(function() {
        $('body').on('click', '.show-extracts',
              openNestedTable('documents', 'extracts', 4));
      });
    </script>
  {% endif %}
  {% if not main %}
    <script type="module">
      import { initNestedTable } from
          '{{ url_for('static', filename='js/nested_table.js') }}';
      $(document).ready(function() { initNestedTable("{{table_id}}"); });
    </script>
  {% endif %}
{% endblock %}

